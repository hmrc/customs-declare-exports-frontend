@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.AppConfig
@import controllers.declaration.routes._
@import controllers.util.{Add, Remove, SaveAndContinue}
@import forms.declaration.destinationCountries.DestinationCountriesStandard
@import services.Country
@import uk.gov.hmrc.play.views.html._

@(form: Form[DestinationCountriesStandard], routingCountries: Seq[String])(implicit request: Request[_], messages: Messages, countries: List[Country], appConfig: AppConfig)

@main_template(
    title = messages("declaration.destinationCountries.title"),
    appConfig = appConfig
) {
    @helpers.form(DestinationCountriesController.saveCountries(), 'autoComplete -> "off") {
        @components.back_link("/customs-declare-exports/declaration/holder-of-authorisation")

        @components.error_summary(form.errors)

        @components.page_title(Some("declaration.destinationCountries.title"))

        <script type="text/javascript">
            function initialiseSelect(selectName){
                var selectElements = document.getElementsByName(selectName);
                var selectElement = selectElements[selectElements.length - 1];
                openregisterLocationPicker({
                    defaultValue: '',
                    selectElement: selectElement,
                    url: '@routes.Assets.versioned("javascripts/location-autocomplete-graph.json")'
                });
                var inputElement = document.getElementsByClassName('autocomplete__input');
                inputElement = inputElement[inputElement.length - 1];
                inputElement.setAttribute('autocomplete', 'false' + selectElements.length);
                if (selectElement.classList.contains("form-control-error")) {
                    inputElement.classList.add("form-control-error");
                }
            }
        </script>

        <div id="country-of-dispatch-field" class="inline-block">
            @components.country_field(
                form,
                "countryOfDispatch",
                "declaration.destinationCountries.countryOfDispatch",
                Some(messages("declaration.destinationCountries.countryOfDispatch.hint")),
                messages("declaration.destinationCountries.countryOfDispatch.empty"),
                countries
            )
        </div>

        <br/>
        <br/>
        <h2>Countries of routing</h2>

        @if(routingCountries.nonEmpty) {
            <div class="field-group">
                <table >
                @for(routingCountry <- routingCountries.zipWithIndex) {
                    <tr>
                        <th>@routingCountry._1</th>
                        <th>
                            <button
                            class="button--secondary"
                            name="@Remove.toString"
                            value="@{
                                routingCountry._2
                            }">@messages("site.remove")</button>
                        </th>
                    </tr>
                }
                </table>
                <br/><br/>
            </div>
        }

        <div id="country-of-dispatch-field" class="inline-block">
        @components.country_field(
            form,
            "countriesOfRouting[]",
            "declaration.destinationCountries.countriesOfRouting",
            None,
            messages("declaration.destinationCountries.countryOfDispatch.empty"),
            countries
        )
        </div>

        <br/>

        <div class="section align='right'">
            <button id="add" class="button--secondary" name="@Add.toString">@messages("site.add")</button>
        </div>

        <br/>

        <div id="country-of-destination-field" class="inline-block">
            @components.country_field(
                form,
                "countryOfDestination",
                "declaration.destinationCountries.countryOfDestination",
                Some(messages("declaration.destinationCountries.countryOfDestination.hint")),
                messages("declaration.destinationCountries.countryOfDestination.empty"),
                countries
            )
        </div>

        <div class="section align='right'">
            <button id="submit" class="button" name="@SaveAndContinue.toString">@messages("site.save_and_continue")</button>
        </div>
    }
}