@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.featureFlags.SecureMessagingConfig

@import java.time.ZoneId
@import forms.Choice
@import forms.Choice.AllowedChoiceValues.Submissions
@import models.declaration.notifications.Notification
@import models.declaration.submissions.RequestType.SubmissionRequest
@import models.declaration.submissions.Submission
@import models.declaration.submissions.SubmissionStatus.{PENDING, QUERY_NOTIFICATION_MESSAGE}
@import viewmodels.SubmissionTabItem
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import views.helpers.{BackButton, EnhancedStatusHelper, Title, ViewDates}
@import views.helpers.EnhancedStatusHelper.hasQueryNotificationMessageStatus
@import views.html.components.gds._
@import views.html.components.submissions._

@this(
    govukLayout: gdsMainTemplate,
    pageTitle: pageTitle,
    govukTabs: GovukTabs,
    govukTable: GovukTable,
    paragraphBody: paragraphBody,
    link: link,
    linkButton: linkButton,
    navigationBanner: navigationBanner,
    secureMessagingConfig: SecureMessagingConfig,
    tabTable: tabTable
)

@(submissionsPagesElements: SubmissionsPagesElements)(implicit request: Request[_], messages: Messages)

@navBanner = {
    @if(secureMessagingConfig.isSecureMessagingEnabled) {
        @navigationBanner(withLinkToSubmissions = false)
    }
}

@submissionsPages = @{
    SubmissionsPages(
        submissionsPagesElements.rejectedSubmissions.page.index,
        submissionsPagesElements.actionSubmissions.page.index,
        submissionsPagesElements.otherSubmissions.page.index
    )
}

@govukLayout(
    title = Title("submissions.title"),
    backButton = Some(BackButton(messages("site.backToSelectionPage"), routes.ChoiceController.displayPage(Some(Choice(Submissions))))),
    useCustomContentWidth = true,
    navigationBanner = navBanner
) {

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">

            @pageTitle(messages("submissions.title"))

            @paragraphBody(message = messages("submissions.hint.no.action.needed"), classes = "govuk-body govuk-warning-text")

            @govukTabs(Tabs(
                items = Seq(
                    SubmissionTabItem("other").tabItem(
                        content = HtmlContent(
                            tabTable(
                                id = "other",
                                submissionsPagesElements.otherSubmissions,
                                page => controllers.routes.SubmissionsController.displayListOfSubmissions(
                                    submissionsPages.changeOtherPageNumber(page)
                                ).withFragment("other-submissions")
                            )
                        )
                    ),
                    SubmissionTabItem("action").tabItem(
                        content = HtmlContent(
                            tabTable(
                                id = "action",
                                submissionsPagesElements.actionSubmissions,
                                page => controllers.routes.SubmissionsController.displayListOfSubmissions(
                                    submissionsPages.changeActionPageNumber(page)
                                ).withFragment("action-submissions")
                            )
                        )
                    ),
                    SubmissionTabItem("rejected").tabItem(
                        content = HtmlContent(
                            tabTable(
                                id = "rejected",
                                submissionsPagesElements.rejectedSubmissions,
                                page => controllers.routes.SubmissionsController.displayListOfSubmissions(
                                    submissionsPages.changeRejectedPageNumber(page)
                                ).withFragment("rejected-submissions")
                            )
                        )
                    ),
                    SubmissionTabItem("cancelled").tabItem(
                        content = HtmlContent(
                            tabTable(
                                id = "cancelled",
                                submissionsPagesElements.cancelledSubmissions,
                                page => controllers.routes.SubmissionsController.displayListOfSubmissions(
                                    submissionsPages.changeCancelledPageNumber(page)
                                ).withFragment("cancelled-submissions")
                            )
                        )
                    )
                )
            ))

            @linkButton("supplementary.startNewDec", routes.ChoiceController.displayPage())
        </div>
    </div>
}
