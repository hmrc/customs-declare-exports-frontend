# customs-declare-exports-frontend

## Summary
This public-facing microservice is part of Customs Exports Declaration Service (CEDS). It is designed to work in tandem with [customs-declare-exports](https://github.com/hmrc/customs-declare-exports) service.

It provides functionality to submit and manage exports declarations.

## Prerequisites

This service depends on other services. The easiest way to set up required microservices is to use Service Manager and profiles from [service-manager-config](https://github.com/hmrc/service-manager-config/) repository:
- `sm2 --start CDS_EXPORTS_DECLARATION_DEPS` - all services EXCEPT both declarations services
- `sm2 --start CDS_EXPORTS_DECLARATION_ALL` - all services together with both declarations services

### Running the application
Start the service with: 

`sbt run`

### Testing the application
This repository contains unit tests for the service. In order to run them, simply execute:

`sbt test`


## Developer notes

### Feature flags
This service uses feature flags to enable/disable some of its features. These can be changed/overridden in config under `microservice.services.features.<featureName>` key.

The list of feature flags and what they are responsible for:

`betaBanner = [true/false]` - When enabled, all pages in the service have BETA banner.

`tdrVersion = [true/false]` - It's enabled when the service runs in 'TDR' (External Test) as this environment requires specific features.

### GDS Components
The service's user interface is always built using the components provided by the [play-frontend-hmrc](https://github.com/hmrc/play-frontend-hmrc/) library except for two of them due to the service's business requirements.
- The ["Summary" Card](https://github.com/hmrc/customs-declare-exports-frontend/blob/main/app/views/summary/summary_card.scala.html) Twirl template was required as the [Card](https://github.com/hmrc/play-frontend-hmrc/tree/main/play-frontend-hmrc-play-30/src/main/scala/uk/gov/hmrc/govukfrontend/views/viewmodels/summarylist/Card.scala)
  component provided by _play-frontend-hmrc_ can only contain a single [SummaryList](https://github.com/hmrc/play-frontend-hmrc/tree/main/play-frontend-hmrc-play-30/src/main/scala/uk/gov/hmrc/govukfrontend/views/viewmodels/summarylist/SummaryList.scala),
  via [GovukSummaryList](https://github.com/hmrc/play-frontend-hmrc/blob/main/play-frontend-hmrc-play-30/src/main/twirl/uk/gov/hmrc/govukfrontend/views/components/GovukSummaryList.scala.html), whereas the service instead requires _Card_(s) potentially containing more than one of them.   
  What's more, each _SummaryList_ might be prefixed, meaning outside the Html of the _SummaryList_, with specific heading tags (H3).\
  However, when used with a single _SummaryList_, our _"Summary" Card_ template generates the same Html, with the same CSS classes, as generated by directly passing a _Card_ to a _GovukSummaryList_.

- The [dashboard/pagination](https://github.com/hmrc/customs-declare-exports-frontend/blob/main/app/views/dashboard/pagination.scala.html) and the [drafts/pagination](https://github.com/hmrc/customs-declare-exports-frontend/blob/main/app/views/drafts/pagination.scala.html)
  Twirl templates were required to support loading a single "page" of documents on demand, as the service, for each of its users, might store an indefinite number of declarations, potentially ten of thousands.  
  However, they generate the same Html, with the same CSS classes, as the Html component sampled at [GDS pagination](https://design-system.service.gov.uk/components/pagination/).


### Scalastyle

Project contains scalafmt plugin.

Commands for code formatting:

```
scalafmt        # format compile sources
test:scalafmt   # format test sources
sbt:scalafmt    # format .sbt source
```

To ensure everything is formatted you can check project using commands below

```
scalafmt::test      # check compile sources
test:scalafmt::test # check test sources
sbt:scalafmt::test  # check .sbt sources
```

### Pre-merge check
There is a script called `precheck.sh` that runs all tests, examine their coverage and check if all the files are properly formatted.
It is a good practise to run it just before pushing to GitHub. 


### Auto Complete

This project has a 
[TamperMonkey](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?hl=en) (Google Chrome)
or 
[GreaseMonkey](https://addons.mozilla.org/en-GB/firefox/addon/greasemonkey/) (Firefox)
Auto Complete Script to help speed through the form journey.

These scripts can be found in the docs directory.

### Tariff Code lists

As per Exports Product Manager and CDS Stakeholders instructions, the [CDS Tariff](https://www.gov.uk/government/collections/uk-trade-tariff-volume-3-for-cds--2) 
is our source of truth for any CDS codes going forward, until further instructions or until we connect with a service that provides this data for us.

We use the following codes:
 * [Country codes](https://www.gov.uk/government/publications/country-codes-for-the-customs-declaration-service) *Last updated 17 March 2023*
 * [Authorisation codes](https://www.gov.uk/government/publications/authorisation-type-codes-for-data-element-339-of-the-customs-declaration-service) (3/39 in tariff) *Last updated 1 July 2022*
 * [UK Office of Exit codes](https://www.gov.uk/government/publications/uk-customs-office-codes-for-data-element-512-of-the-customs-declaration-service) (5/12 in tariff) *Last updated 17 April 2023*
 * [Document type codes (previous document page)](https://www.gov.uk/government/publications/previous-document-codes-for-data-element-21-of-the-customs-declaration-service) (2/1 in tariff) *Last published: 1 August 2018*
 * [Package Type codes](https://www.gov.uk/government/publications/package-type-codes-for-data-element-69-of-the-customs-declaration-service) (6/9 in tariff) *Last published: 1 August 2018*
 * [Customs supervising office codes](https://www.gov.uk/government/publications/supervising-office-codes-for-data-element-527-of-the-customs-declaration-service) (5/27 in tariff) *Last updated 13 March 2023*

## License

This code is open source software licensed under the [Apache 2.0 License]("http://www.apache.org/licenses/LICENSE-2.0.html")
